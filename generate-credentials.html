<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Generate Admin Credentials</title>

  <style>
    :root {
      --bg-1: #0b0f18;
      --bg-2: #121826;
      --glass: rgba(255,255,255,.06);
      --glass-strong: rgba(255,255,255,.12);
      --border: rgba(255,255,255,.12);
      --text: #e6e9ef;
      --muted: #b3b9c6;
      --primary: #7aa2ff;
      --primary-2: #6391ff;
      --danger: #ff6b6b;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body.simple-center {
      margin: 0;
      color: var(--text);
      background: radial-gradient(1200px 800px at 20% 10%, #152034 0%, transparent 60%),
                  radial-gradient(1000px 600px at 90% 10%, #1a2a4a 0%, transparent 60%),
                  linear-gradient(180deg, var(--bg-1), var(--bg-2));
      display: grid;
      place-items: center;
      font: 15px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    .container {
      width: min(92vw, 680px);
      background: rgba(20,20,28,.55);
      backdrop-filter: saturate(160%) blur(12px);
      -webkit-backdrop-filter: saturate(160%) blur(12px);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 22px 22px 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    h2 { margin: 4px 0 6px; font-weight: 650; letter-spacing: .2px; }
    p { margin: 0; color: var(--muted); }

    label { display:block; margin-top: 14px; margin-bottom: 6px; color: var(--text); }
    input, textarea {
      width: 100%;
      background: var(--glass);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px 14px;
      outline: none;
      transition: border-color .15s ease, box-shadow .15s ease, background .15s ease;
    }
    input:focus, textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(122,162,255,.15);
      background: var(--glass-strong);
    }
    .input-with-icon { position: relative; }
    .input-with-icon .icon-button {
      position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
      cursor: pointer; user-select: none; opacity: .8;
    }
    .input-with-icon .icon-button:hover { opacity: 1; }

    .button-apply, .button-secondary {
      appearance: none; border: 1px solid var(--border); color: var(--text);
      padding: 10px 14px; border-radius: 12px; cursor: pointer;
      transition: transform .05s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease;
    }
    .button-apply {
      background: linear-gradient(180deg, var(--primary), var(--primary-2));
      border-color: rgba(0,0,0,.2);
      color: white;
      box-shadow: 0 6px 18px rgba(99,145,255,.35);
    }
    .button-apply:hover { filter: brightness(1.02); }
    .button-apply:active { transform: translateY(1px); }

    .button-secondary { background: var(--glass); }
    .button-secondary:hover { background: var(--glass-strong); }
    .button-secondary:active { transform: translateY(1px); }

    .content-card {
      margin-top: 16px; padding: 14px; border: 1px solid var(--border);
      border-radius: 14px; background: rgba(255,255,255,.04);
    }
    .hidden { display: none; }
    .error {
      margin-top: 12px; padding: 10px 12px; border-radius: 12px;
      background: rgba(255, 107, 107, .12); border: 1px solid rgba(255,107,107,.35);
      color: #ffd7d7;
    }
  </style>

  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline';
    style-src 'self' 'unsafe-inline';
    img-src 'self' data:;
    font-src 'self';
    connect-src 'self';
    base-uri 'none';
    form-action 'self';
    object-src 'none';
  ">
</head>
<body class="simple-center">
  <div class="container" style="max-width:680px;">
    <h2>Generate Admin Credentials</h2>
    <p style="opacity:.9;margin-top:-4px">Runs entirely in your browser. Nothing is sent anywhere.</p>

    <div id="error" class="error hidden"></div>

    <form id="gen-form" autocomplete="off" style="margin-top:18px">
      <label for="username">Admin Username</label>
      <input id="username" name="username" type="text" placeholder="e.g., admin" required class="centered-input" />

      <label for="password" style="margin-top:10px;">Admin Password</label>
      <div class="input-with-icon">
        <input id="password" name="password" type="password" placeholder="Choose a strong password" required />
        <span class="icon-button" id="togglePw" title="Show/Hide Password">&#128065;</span>
      </div>

      <button type="submit" class="button-apply" style="display:block;margin:16px auto 0;">Generate</button>
    </form>

    <div id="results" class="content-card hidden" style="margin-top:22px;">
      <h3 style="margin-top:0">Your Env Values</h3>

      <label for="userHash" style="margin-top:10px;">ADMIN_USER_HASH (SHA-256 of username)</label>
      <div class="input-with-icon">
        <input id="userHash" readonly />
      </div>
      <div style="display:flex;justify-content:center;margin-top:8px;">
        <button class="button-secondary" id="copyUserHashBtn">Copy ADMIN_USER_HASH</button>
      </div>

      <label for="passHash" style="margin-top:10px;">ADMIN_PASS_PBKDF2 (PBKDF2-SHA256)</label>
      <div class="input-with-icon">
        <input id="passHash" readonly />
      </div>
      <div style="display:flex;justify-content:center;margin-top:8px;">
        <button class="button-secondary" id="copyPassHashBtn">Copy ADMIN_PASS_PBKDF2</button>
      </div>

      <p style="font-size:.9em;color:#ccc;margin-top:8px;">
        Uses 100,000 PBKDF2 iterations with SHA-256 and a random 32-byte salt to match your Worker.
      </p>
    </div>
  </div>

  <script>
    const PBKDF2_ITERATIONS = 100000;
    const te = new TextEncoder();

    function toHex(u8) {
      return [...u8].map(b => b.toString(16).padStart(2, '0')).join('');
    }

    async function sha256Hex(str) {
      const digest = await crypto.subtle.digest('SHA-256', te.encode(str));
      return toHex(new Uint8Array(digest));
    }

    async function pbkdf2Sha256Hex(password, saltU8, iterations = PBKDF2_ITERATIONS, bits = 256) {
      const key = await crypto.subtle.importKey('raw', te.encode(password), { name: 'PBKDF2' }, false, ['deriveBits']);
      const derived = await crypto.subtle.deriveBits(
        { name: 'PBKDF2', hash: 'SHA-256', iterations, salt: saltU8 },
        key,
        bits
      );
      return toHex(new Uint8Array(derived));
    }

    async function makeAdminPassHash(password) {
      const salt = new Uint8Array(32);
      crypto.getRandomValues(salt);
      const hashHex = await pbkdf2Sha256Hex(password, salt);
      return `pbkdf2:${PBKDF2_ITERATIONS}:${toHex(salt)}:${hashHex}`;
    }

    const form = document.getElementById('gen-form');
    const usernameEl = document.getElementById('username');
    const passwordEl = document.getElementById('password');
    const results = document.getElementById('results');
    const userHashEl = document.getElementById('userHash');
    const passHashEl = document.getElementById('passHash');
    const errorEl = document.getElementById('error');

    const copyUserBtn = document.getElementById('copyUserHashBtn');
    const copyPassBtn = document.getElementById('copyPassHashBtn');
    const togglePw = document.getElementById('togglePw');

    togglePw.addEventListener('click', () => {
      passwordEl.type = passwordEl.type === 'password' ? 'text' : 'password';
    });

    copyUserBtn.addEventListener('click', () => {
      navigator.clipboard.writeText(userHashEl.value);
      const prev = copyUserBtn.textContent;
      copyUserBtn.textContent = 'Copied!';
      setTimeout(() => (copyUserBtn.textContent = prev || 'Copy ADMIN_USER_HASH'), 1200);
    });

    copyPassBtn.addEventListener('click', () => {
      navigator.clipboard.writeText(passHashEl.value);
      const prev = copyPassBtn.textContent;
      copyPassBtn.textContent = 'Copied!';
      setTimeout(() => (copyPassBtn.textContent = prev || 'Copy ADMIN_PASS_PBKDF2'), 1200);
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      errorEl.classList.add('hidden');
      errorEl.textContent = '';

      const username = usernameEl.value.trim();
      const password = passwordEl.value;

      if (!username || !password) {
        errorEl.textContent = 'Please provide both a username and a password.';
        errorEl.classList.remove('hidden');
        return;
      }

      try {
        const userHash = await sha256Hex(username);
        const passHash = await makeAdminPassHash(password);

        userHashEl.value = userHash;
        passHashEl.value = passHash;
        results.classList.remove('hidden');
      } catch (err) {
        console.error(err);
        errorEl.textContent = 'Credential generation failed in the browser.';
        errorEl.classList.remove('hidden');
      }
    });
  </script>
</body>
</html>
